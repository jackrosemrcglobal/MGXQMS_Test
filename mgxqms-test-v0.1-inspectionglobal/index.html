<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inspection Report Form</title>
    <link rel="stylesheet" href="styles/base.css">
    <link rel="stylesheet" href="styles/layout.css">
    <link rel="stylesheet" href="styles/form-elements.css">
    <link rel="stylesheet" href="styles/tables.css">
    <link rel="stylesheet" href="styles/components.css">
</head>
<body>
    <div id="sidebar" class="sidebar">
        <div class="sidebar-header">
            <h2>Menu</h2>
        </div>
        <div class="sidebar-content">
            <button id="refresh-form-btn" class="sidebar-btn">Refresh Form</button>
            <button id="export-json-btn" class="sidebar-btn">Export to JSON</button>
            <button id="import-json-btn" class="sidebar-btn">Import from JSON</button>
            <button id="export-settings-btn" class="sidebar-btn">Export Settings</button>
            <button id="import-settings-btn" class="sidebar-btn">Import Settings</button>
            <button id="print-options-btn" class="sidebar-btn">Print Options</button>
            <button id="export-docx-btn" class="sidebar-btn">Export to DOCX</button>
            <button id="export-xlsx-btn" class="sidebar-btn">Export to XLSX</button>
            <button id="export-pdf-btn" class="sidebar-btn">Export to PDF</button>
            <button id="release-notes-btn" class="sidebar-btn">Release Notes</button>
            <div class="sidebar-form-style">
                <label for="form-style-select" class="sidebar-label">Form Style:</label>
                <select id="form-style-select" class="sidebar-select">
                    <option value="default">Default Professional</option>
                    <option value="corporate-blue">Corporate Blue</option>
                    <option value="forest-green">Forest Green</option>
                    <option value="burgundy-wine">Burgundy Wine</option>
                    <option value="slate-gray">Slate Gray</option>
                    <option value="navy-gold">Navy & Gold</option>
                    <option value="charcoal-orange">Charcoal Orange</option>
                    <option value="teal-silver">Teal Silver</option>
                    <option value="purple-cream">Purple Cream</option>
                    <option value="brown-tan">Brown Tan</option>
                    <option value="midnight-blue">Midnight Blue</option>
                    <option value="olive-beige">Olive Beige</option>
                    <option value="crimson-gray">Crimson Gray</option>
                    <option value="emerald-ivory">Emerald Ivory</option>
                    <option value="steel-blue">Steel Blue</option>
                    <option value="copper-cream">Copper Cream</option>
                    <option value="black-white">Black & White</option>
                    <option value="no-color">No Color</option>
                </select>
            </div>
            <div class="sidebar-form-layout">
                <label for="form-layout-select" class="sidebar-label">Form Layout:</label>
                <select id="form-layout-select" class="sidebar-select">
                    <option value="default">Default Layout</option>
                    <option value="compact">Compact Layout</option>
                    <option value="wide-screen">Wide Screen Layout</option>
                    <option value="narrow">Narrow Layout</option>
                    <option value="minimal">Minimal Layout</option>
                    <option value="tabular">Tabular Layout (Print Optimized)</option>
                </select>
            </div>
            <div class="sidebar-section-toggle">
                <label for="section-toggle-select" class="sidebar-label">Show/Hide Sections:</label>
                <select id="section-toggle-select" class="sidebar-select">
                    <option value="">Select Action...</option>
                    <option value="show-all">Show All Sections</option>
                    <option value="hide-all">Hide All Sections</option>
                    <option value="custom">Custom Selection...</option>
                </select>
            </div>
            <div class="sidebar-template-selector">
                <label for="template-select" class="sidebar-label">Template:</label>
                <select id="template-select" class="sidebar-select">
                    <option value="master-view">Master View</option>
                    <option value="create-custom-inspection">Create Custom Inspection</option>
                    <option value="image-attachments">Image Attachments</option>
                    <option value="iso-checklist">ISO Checklist</option>
                    <option value="aml">AML</option>
                    <option value="international-audit">Inspection Report (International)</option>
                    <option value="create-new-template">Create New Template...</option>
                </select>
                <button id="edit-template-btn" class="sidebar-btn" style="margin-top: 8px; font-size: 0.7em;">Edit Templates</button>
            </div>
        </div>
    </div>
    <div id="overlay" class="overlay"></div>
    
    <div class="title-block">
        <img src="company-logo.png" alt="Company Logo" id="company-logo">
        <div class="title-text-container">
            <h1>Inspection Report Form</h1>
            <div class="title-info">
                <p>Professional inspection documentation system for comprehensive quality assurance and compliance reporting.</p>
            </div>
        </div>
        <button id="hamburger-menu" class="hamburger-menu">
            <span></span>
            <span></span>
            <span></span>
        </button>
    </div>
    
    <form action="#" id="inspection-form">
        <!-- Form sections will be dynamically generated -->
    </form>

    <script type="importmap">
    {
      "imports": {
        "jszip": "https://esm.sh/jszip@3.10.1",
        "docx": "https://esm.sh/docx@8.5.0",
        "xlsx": "https://esm.sh/xlsx@0.18.5"
      }
    }
    </script>
    <script type="module" src="script.js"></script>
    <!-- removed all the large form structures - moved to formSections.js -->

    <!-- Print Options Modal -->
    <div id="print-options-modal" class="modal no-print">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Print Options</h2>
                <button id="close-print-modal" class="close-button">&times;</button>
            </div>
            <div class="modal-body">
                <h4>Sections to Print</h4>
                <div id="print-section-checklist">
                    <!-- Checkboxes for sections will be dynamically inserted here -->
                </div>
                <hr>
                <h4>Other Options</h4>
                <div class="print-option-item">
                    <label>
                        <input type="checkbox" id="print-opt-images" checked>
                        Include Images
                    </label>
                </div>
                 <div class="print-option-item">
                    <label>
                        <input type="checkbox" id="print-opt-empty-fields">
                        Hide Empty Rows/Fields
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button id="print-form-btn" class="sidebar-btn">Print</button>
            </div>
        </div>
    </div>

    <!-- Custom Theme Creator Modal -->
    <div id="custom-theme-modal" class="custom-theme-modal no-print">
        <div class="custom-theme-content">
            <div class="modal-header">
                <h2>Create Custom Theme</h2>
                <button id="close-custom-theme-modal" class="close-button">&times;</button>
            </div>
            <div class="modal-body">
                <input type="text" id="custom-theme-name" class="custom-theme-name-input" placeholder="Enter theme name...">
                
                <div class="theme-colors-grid" id="theme-colors-grid">
                    <!-- Color pickers will be generated here -->
                </div>
                
                <div class="theme-preview-section">
                    <h4>Preview</h4>
                    <div style="padding: 10px; background: var(--fieldset-bg); border: 2px solid var(--border-color);">
                        <div style="background: var(--legend-bg); color: var(--legend-text); padding: 8px 16px; margin-bottom: 10px;">Sample Legend</div>
                        <div style="background: var(--input-bg); border: 1px solid var(--input-border); padding: 8px; margin-bottom: 10px;">Sample Input Field</div>
                        <table style="width: 100%; border-collapse: collapse;">
                            <tr style="background: var(--table-header-bg);">
                                <th style="border: 1px solid var(--border-color); padding: 5px;">Header</th>
                                <th style="border: 1px solid var(--border-color); padding: 5px;">Header</th>
                            </tr>
                            <tr style="background: var(--table-even-row);">
                                <td style="border: 1px solid var(--border-color); padding: 5px;">Data</td>
                                <td style="border: 1px solid var(--border-color); padding: 5px;">Data</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
            <div class="theme-actions">
                <button id="save-custom-theme" class="theme-btn theme-btn-primary">Save Theme</button>
                <button id="cancel-custom-theme" class="theme-btn theme-btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Template Creator Modal -->
    <div id="template-creator-modal" class="modal no-print">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Template Creator</h2>
                <button id="close-template-creator" class="close-button">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="template-name-input">Template Name:</label>
                    <input type="text" id="template-name-input" class="template-input" placeholder="Enter template name..." maxlength="50">
                </div>
                <div class="form-group">
                    <label for="template-description-input">Description (optional):</label>
                    <textarea id="template-description-input" class="template-input" rows="2" placeholder="Enter template description..." maxlength="200"></textarea>
                </div>
                <h4>Select Sections to Include:</h4>
                <div id="template-section-checklist" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 10px; max-height: 40vh; overflow-y: auto; background-color: #f9f9f9; border: 1px solid #eee; padding: 15px; border-radius: 4px;">
                    <!-- Section checkboxes will be populated here -->
                </div>
            </div>
            <div class="modal-footer">
                <button id="save-template-btn" class="sidebar-btn">Save Template</button>
                <button id="cancel-template-btn" class="sidebar-btn" style="background: #6c757d;">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Template Manager Modal -->
    <div id="template-manager-modal" class="modal no-print">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Manage Templates</h2>
                <button id="close-template-manager" class="close-button">&times;</button>
            </div>
            <div class="modal-body">
                <h4>Custom Templates</h4>
                <div id="custom-templates-list" style="max-height: 50vh; overflow-y: auto;">
                    <!-- Custom templates will be listed here -->
                </div>
            </div>
            <div class="modal-footer">
                <button id="close-template-manager-btn" class="sidebar-btn">Close</button>
            </div>
        </div>
    </div>

    <!-- Release Notes Modal -->
    <div id="release-notes-modal" class="modal no-print">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Release Notes - Inspection Report Form</h2>
                <button id="close-release-notes-modal" class="close-button">&times;</button>
            </div>
            <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                <div class="release-info">
                    <p><strong>Version:</strong> 2.1.0</p>
                    <p><strong>Release Date:</strong> December 2024</p>
                </div>

                <h3>1. Overview</h3>
                <p>This release focuses on enhancing the inspection report form capabilities with improved export functionality, better user experience, and comprehensive quality management features. Key highlights include advanced document export options, customizable templates, and enhanced data management.</p>

                <h3>2. New Features</h3>
                <div class="feature-section">
                    <h4>Multi-Format Export System</h4>
                    <p>Added comprehensive export capabilities including JSON, DOCX, XLSX, and PDF formats with customizable formatting and content selection.</p>
                    
                    <h4>Template Management System</h4>
                    <p>Introduced a complete template creator and manager allowing users to create, save, edit, and apply custom inspection templates for different scenarios (Master View, ISO Checklist, AML, etc.).</p>
                    
                    <h4>Advanced Image Management</h4>
                    <p>Implemented a robust image attachment system with drag-and-drop upload, commenting, ordering, and ZIP export functionality with persistent storage.</p>
                    
                    <h4>Extended Audit Checklist</h4>
                    <p>Added comprehensive audit checklist functionality with CSV import/export, configurable audit points, and detailed scoring system.</p>
                    
                    <h4>Approved Manufacturers List</h4>
                    <p>Created a complete manufacturers management system with pagination, CSV import/export, and detailed manufacturer information tracking.</p>
                </div>

                <h3>3. Improvements</h3>
                <div class="improvement-section">
                    <h4>Enhanced User Interface</h4>
                    <p>Redesigned the sidebar navigation with improved organization and added hamburger menu for better mobile experience.</p>
                    
                    <h4>Form Data Persistence</h4>
                    <p>Implemented automatic form saving with debounced updates and comprehensive data recovery capabilities.</p>
                    
                    <h4>Print Optimization</h4>
                    <p>Enhanced print functionality with section selection, empty field hiding, and optimized layouts for professional reporting.</p>
                    
                    <h4>Theme Customization</h4>
                    <p>Added 17+ pre-built themes and custom theme creator with real-time preview for personalized appearance.</p>
                    
                    <h4>Section Management</h4>
                    <p>Improved section visibility controls with drag-and-drop reordering and template-based section selection.</p>
                </div>

                <h3>4. Bug Fixes</h3>
                <div class="bugfix-section">
                    <h4>DOCX Export Border Issues</h4>
                    <p>Fixed BorderStyle import errors in DOCX export functionality ensuring proper table formatting and borders.</p>
                    
                    <h4>Form Data Loss Prevention</h4>
                    <p>Resolved issues where form data could be lost during navigation or browser refresh.</p>
                    
                    <h4>Table Row Visibility</h4>
                    <p>Fixed problems with hidden table rows appearing in print output when they should remain hidden.</p>
                    
                    <h4>Mobile Responsiveness</h4>
                    <p>Addressed layout issues on mobile devices and improved touch interaction for better usability.</p>
                </div>

                <h3>5. Technical Enhancements</h3>
                <div class="technical-section">
                    <h4>Performance Optimization</h4>
                    <p>Removed unnecessary animations and transitions for faster loading and better performance on older devices.</p>
                    
                    <h4>Data Storage</h4>
                    <p>Implemented IndexedDB for image storage and enhanced localStorage management for form data persistence.</p>
                    
                    <h4>Code Architecture</h4>
                    <p>Refactored codebase into modular components for better maintainability and feature development.</p>
                </div>

                <h3>6. Quality Management Features</h3>
                <div class="qm-section">
                    <h4>ISO 9001:2015 Compliance</h4>
                    <p>Comprehensive audit checklist covering all ISO 9001:2015 requirements with Process-Based Approach, Risk-Based Thinking, and PDCA cycle integration.</p>
                    
                    <h4>Inspection Documentation</h4>
                    <p>Complete inspection tables for valves, actuators, ancillaries, and other components with pass/fail/N/A tracking and guidance notes.</p>
                    
                    <h4>Document Management</h4>
                    <p>Built-in document reference system with standard specifications (API, ASME, PED) and custom document tracking.</p>
                    
                    <h4>Calibration Tracking</h4>
                    <p>Comprehensive calibration management with equipment tracking, certificate numbers, and due date monitoring.</p>
                </div>

                <h3>7. Known Issues</h3>
                <div class="known-issues-section">
                    <h4>Large File Handling</h4>
                    <p>Performance may be impacted when uploading very large images (>10MB). Recommended to compress images before upload.</p>
                    
                    <h4>Internet Explorer Support</h4>
                    <p>Limited functionality in Internet Explorer. Modern browsers (Chrome, Firefox, Safari, Edge) are recommended for full feature support.</p>
                </div>

                <h3>8. Browser Compatibility</h3>
                <div class="compatibility-section">
                    <p><strong>Fully Supported:</strong> Chrome 90+, Firefox 88+, Safari 14+, Edge 90+</p>
                    <p><strong>Operating Systems:</strong> Windows 10+, macOS 10.15+, Linux (modern distributions)</p>
                    <p><strong>Mobile:</strong> iOS Safari 14+, Chrome Mobile 90+</p>
                </div>

                <h3>9. Security Updates</h3>
                <div class="security-section">
                    <h4>Data Protection</h4>
                    <p>Enhanced client-side data protection with improved localStorage encryption and secure data handling practices.</p>
                    
                    <h4>Input Validation</h4>
                    <p>Strengthened input validation and sanitization to prevent potential security vulnerabilities.</p>
                </div>

                <h3>10. Contact Information</h3>
                <div class="contact-section">
                    <p><strong>Support:</strong> For technical support or feature requests, please contact your system administrator.</p>
                    <p><strong>Documentation:</strong> Additional help documentation is available within the application interface.</p>
                    <p><strong>Version Info:</strong> Check the browser console for detailed version and build information.</p>
                </div>
            </div>
            <div class="modal-footer">
                <button id="close-release-notes-btn" class="sidebar-btn">Close</button>
            </div>
        </div>
    </div>
</body>
</html>